{% extends "main/layout.html" %}

{% block title %}
    CollageVibs
{% endblock %}

{% block content %}
<wrapper class="wrapper">
  <div id="chat_window" class="chat-window">
    <div class="chat-header">
      <span id="online-count" class="online-count">3</span>online
    </div>

    <div id="chat_container" class="chat-container">
      <ul id="chat_messages" class="chat-messages">
    {% for chat in global_chat_messages reversed %}
    {% include "globalchat/global_chat_message.html" %}
    {% endfor %}
      </ul>
    </div>

    <div class="chat-footer">
      <div class="input-wrapper">
        <form id="chat_message_form"  class="input-form"
        hx-post="{% url 'globalchat:global_chat' %}"
        hx-target="#chat_messages"
        hx-swap="beforeend"
        _="on htmx:beforeSend reset() me" >
          {% csrf_token %}
          {{ form.message }}
        </form>
      </div>
    </div>
  </div>
</wrapper>
<script>
  document.body.addEventListener('htmx:afterSwap', (e) => {
    const chatContainer = document.getElementById('chat_container');
    chatContainer.scrollTop = chatContainer.scrollHeight;
  });
    document.body.addEventListener('htmx:afterSwap', (e) => {
    const chatContainer = document.getElementById('chat_container');
    chatContainer.scrollTop = chatContainer.scrollHeight;

    // Add animation to the last message
    const messages = document.querySelectorAll(".chat-message");
    const lastMessage = messages[messages.length - 1];
    if (lastMessage) {
      // Ensure it's freshly added
      lastMessage.classList.add("appear");

      // Optional: remove class after animation ends to allow retrigger
      setTimeout(() => {
        lastMessage.classList.remove("new-message");
      }, 500);
    }
  });
</script>


{% endblock %}